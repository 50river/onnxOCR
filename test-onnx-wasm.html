<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONNX Runtime Web WASM ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
            border-left: 4px solid;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border-color: #28a745;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border-color: #dc3545;
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border-color: #17a2b8;
        }
        .warning { 
            background: #fff3cd; 
            color: #856404; 
            border-color: #ffc107;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 4px;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #495057;
        }
        
        #debugLog {
            background: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .log-error { color: #dc3545; }
        .log-success { color: #28a745; }
        .log-warning { color: #ffc107; }
        .log-info { color: #17a2b8; }
        
        .feature-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .feature-table th,
        .feature-table td {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            text-align: left;
        }
        
        .feature-table th {
            background: #e9ecef;
            font-weight: bold;
        }
        
        .feature-available { color: #28a745; font-weight: bold; }
        .feature-unavailable { color: #dc3545; font-weight: bold; }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #007bff;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  ONNX Runtime Web WASM ãƒ†ã‚¹ãƒˆ</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ONNX Runtime Webã®WASMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§ã™ã€‚</p>
        
        <div id="overallStatus" class="status info">
            ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...
        </div>
        
        <div class="test-section">
            <h3>ğŸ” ç’°å¢ƒãƒã‚§ãƒƒã‚¯</h3>
            <table class="feature-table">
                <thead>
                    <tr>
                        <th>æ©Ÿèƒ½</th>
                        <th>å¯¾å¿œçŠ¶æ³</th>
                        <th>è©³ç´°</th>
                    </tr>
                </thead>
                <tbody id="featureTable">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ ONNX Runtime Web ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testONNXRuntimeWeb()" id="onnxTestBtn">ONNX Runtime Web ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button onclick="testWASMBackends()" id="wasmTestBtn">WASMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testModelLoading()" id="modelTestBtn">ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</button>
            <div class="progress-bar" style="display: none;" id="testProgress">
                <div class="progress-fill" id="testProgressFill"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="runPerformanceTest()" id="perfTestBtn">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <div id="performanceResults" style="display: none;">
                <h4>çµæœ:</h4>
                <table class="feature-table">
                    <thead>
                        <tr>
                            <th>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰</th>
                            <th>åˆæœŸåŒ–æ™‚é–“</th>
                            <th>æ¨è«–æ™‚é–“</th>
                            <th>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</th>
                        </tr>
                    </thead>
                    <tbody id="performanceTable">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
            <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <div id="debugLog"></div>
        </div>
    </div>

    <!-- ONNX Runtime Web -->
    <script src="libs/ort.min.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let testResults = {};
        let performanceResults = {};
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkEnvironment();
            log('ONNX Runtime Web WASMãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
        });
        
        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, message);
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateOverallStatus(message, type = 'info') {
            const status = document.getElementById('overallStatus');
            status.textContent = message;
            status.className = `status ${type}`;
            log(message, type);
        }
        
        // é€²è¡ŒçŠ¶æ³ã®æ›´æ–°
        function updateProgress(percentage) {
            const progressBar = document.getElementById('testProgress');
            const progressFill = document.getElementById('testProgressFill');
            
            if (percentage > 0) {
                progressBar.style.display = 'block';
                progressFill.style.width = percentage + '%';
            } else {
                progressBar.style.display = 'none';
            }
        }
        
        // ç’°å¢ƒãƒã‚§ãƒƒã‚¯
        function checkEnvironment() {
            const features = [
                {
                    name: 'WebAssembly',
                    available: typeof WebAssembly !== 'undefined',
                    detail: typeof WebAssembly !== 'undefined' ? 'ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿' : 'æœªå¯¾å¿œ'
                },
                {
                    name: 'SharedArrayBuffer',
                    available: typeof SharedArrayBuffer !== 'undefined',
                    detail: typeof SharedArrayBuffer !== 'undefined' ? 'ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å¯¾å¿œ' : 'ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã¿'
                },
                {
                    name: 'ONNX Runtime Web',
                    available: typeof ort !== 'undefined',
                    detail: typeof ort !== 'undefined' ? `ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${ort.version || 'unknown'}` : 'æœªèª­ã¿è¾¼ã¿'
                },
                {
                    name: 'Web Workers',
                    available: typeof Worker !== 'undefined',
                    detail: typeof Worker !== 'undefined' ? 'ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿' : 'æœªå¯¾å¿œ'
                },
                {
                    name: 'Hardware Concurrency',
                    available: navigator.hardwareConcurrency > 0,
                    detail: `${navigator.hardwareConcurrency || 'unknown'} ã‚³ã‚¢`
                }
            ];
            
            const featureTable = document.getElementById('featureTable');
            featureTable.innerHTML = '';
            
            features.forEach(feature => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${feature.name}</td>
                    <td class="${feature.available ? 'feature-available' : 'feature-unavailable'}">
                        ${feature.available ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ åˆ©ç”¨ä¸å¯'}
                    </td>
                    <td>${feature.detail}</td>
                `;
                featureTable.appendChild(row);
            });
            
            // å…¨ä½“çš„ãªå¯¾å¿œçŠ¶æ³ã‚’åˆ¤å®š
            const criticalFeatures = features.filter(f => ['WebAssembly', 'ONNX Runtime Web'].includes(f.name));
            const allCriticalSupported = criticalFeatures.every(f => f.available);
            
            if (allCriticalSupported) {
                updateOverallStatus('ç’°å¢ƒãƒã‚§ãƒƒã‚¯å®Œäº†: ONNX Runtime Web WASMå¯¾å¿œ', 'success');
            } else {
                updateOverallStatus('ç’°å¢ƒãƒã‚§ãƒƒã‚¯å®Œäº†: ä¸€éƒ¨æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'warning');
            }
        }
        
        // ONNX Runtime Web ãƒ†ã‚¹ãƒˆ
        async function testONNXRuntimeWeb() {
            if (typeof ort === 'undefined') {
                log('âŒ ONNX Runtime WebãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            document.getElementById('onnxTestBtn').disabled = true;
            updateProgress(0);
            
            try {
                log('=== ONNX Runtime Web ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
                updateProgress(10);
                
                // ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
                log(`ONNX Runtime Web ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${ort.version || 'unknown'}`, 'info');
                updateProgress(20);
                
                // åˆ©ç”¨å¯èƒ½ãªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ç¢ºèª
                log('åˆ©ç”¨å¯èƒ½ãªãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:', 'info');
                const backends = ['webgl', 'wasm', 'webgpu'];
                
                for (const backend of backends) {
                    updateProgress(30 + backends.indexOf(backend) * 20);
                    try {
                        const supported = await checkBackendSupport(backend);
                        log(`  ${backend}: ${supported ? 'âœ… ã‚µãƒãƒ¼ãƒˆ' : 'âŒ æœªã‚µãƒãƒ¼ãƒˆ'}`, supported ? 'success' : 'warning');
                    } catch (error) {
                        log(`  ${backend}: âŒ ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                    }
                }
                
                updateProgress(90);
                
                // WASMè¨­å®šã®ç¢ºèª
                if (ort.env && ort.env.wasm) {
                    log('WASMè¨­å®š:', 'info');
                    log(`  wasmPaths: ${ort.env.wasm.wasmPaths || 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ'}`, 'info');
                    log(`  numThreads: ${ort.env.wasm.numThreads || 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ'}`, 'info');
                    log(`  simd: ${ort.env.wasm.simd || false}`, 'info');
                }
                
                updateProgress(100);
                log('âœ… ONNX Runtime Web ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ ONNX Runtime Web ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                document.getElementById('onnxTestBtn').disabled = false;
                setTimeout(() => updateProgress(0), 2000);
            }
        }
        
        // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
        async function checkBackendSupport(backend) {
            try {
                // ç°¡å˜ãªãƒ†ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
                const testModel = createTestModel();
                
                // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ãƒ†ã‚¹ãƒˆ
                const session = await ort.InferenceSession.create(testModel, {
                    executionProviders: [backend]
                });
                
                await session.release();
                return true;
                
            } catch (error) {
                console.warn(`Backend ${backend} test failed:`, error);
                return false;
            }
        }
        
        // ãƒ†ã‚¹ãƒˆç”¨ã®æœ€å°ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
        function createTestModel() {
            // æœ€å°é™ã®ONNXãƒ¢ãƒ‡ãƒ«ï¼ˆæ’ç­‰é–¢æ•°ï¼‰ã‚’ãƒã‚¤ãƒŠãƒªã§ä½œæˆ
            const modelBytes = new Uint8Array([
                0x08, 0x01, 0x12, 0x0c, 0x62, 0x61, 0x63, 0x6b, 0x65, 0x6e, 0x64, 0x2d, 0x74, 0x65, 0x73, 0x74,
                0x3a, 0x20, 0x0a, 0x01, 0x78, 0x12, 0x01, 0x79, 0x22, 0x08, 0x49, 0x64, 0x65, 0x6e, 0x74, 0x69,
                0x74, 0x79, 0x12, 0x0c, 0x74, 0x65, 0x73, 0x74, 0x2d, 0x6d, 0x6f, 0x64, 0x65, 0x6c, 0x2d, 0x76,
                0x31
            ]);
            return modelBytes;
        }
        
        // WASMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
        async function testWASMBackends() {
            if (typeof ort === 'undefined') {
                log('âŒ ONNX Runtime WebãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            document.getElementById('wasmTestBtn').disabled = true;
            updateProgress(0);
            
            try {
                log('=== WASMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
                updateProgress(10);
                
                // WASMè¨­å®šã®é©ç”¨
                ort.env.wasm.wasmPaths = './libs/';
                ort.env.wasm.numThreads = Math.min(navigator.hardwareConcurrency || 4, 4);
                ort.env.wasm.simd = true;
                
                if (typeof SharedArrayBuffer !== 'undefined') {
                    ort.env.wasm.proxy = true;
                }
                
                log('WASMè¨­å®šã‚’é©ç”¨ã—ã¾ã—ãŸ', 'info');
                updateProgress(30);
                
                // WASMãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
                const wasmFiles = [
                    'ort-wasm.wasm',
                    'ort-wasm-simd.wasm',
                    'ort-wasm-threaded.wasm',
                    'ort-wasm-simd-threaded.wasm'
                ];
                
                for (const wasmFile of wasmFiles) {
                    try {
                        const response = await fetch(`./libs/${wasmFile}`, { method: 'HEAD' });
                        if (response.ok) {
                            const size = response.headers.get('content-length');
                            log(`âœ… ${wasmFile}: å­˜åœ¨ (${Math.round(size / 1024)} KB)`, 'success');
                        } else {
                            log(`âŒ ${wasmFile}: è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (HTTP ${response.status})`, 'error');
                        }
                    } catch (error) {
                        log(`âŒ ${wasmFile}: ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                    }
                }
                
                updateProgress(60);
                
                // WASMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆãƒ†ã‚¹ãƒˆ
                try {
                    const testModel = createTestModel();
                    const session = await ort.InferenceSession.create(testModel, {
                        executionProviders: ['wasm'],
                        graphOptimizationLevel: 'all',
                        executionMode: 'sequential'
                    });
                    
                    log('âœ… WASMã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆæˆåŠŸ', 'success');
                    
                    // ç°¡å˜ãªæ¨è«–ãƒ†ã‚¹ãƒˆ
                    const inputTensor = new ort.Tensor('float32', [1, 2, 3, 4], [1, 4]);
                    const feeds = { x: inputTensor };
                    const results = await session.run(feeds);
                    
                    log('âœ… WASMæ¨è«–ãƒ†ã‚¹ãƒˆæˆåŠŸ', 'success');
                    
                    await session.release();
                    
                } catch (error) {
                    log(`âŒ WASMã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
                
                updateProgress(100);
                log('âœ… WASMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ WASMãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                document.getElementById('wasmTestBtn').disabled = false;
                setTimeout(() => updateProgress(0), 2000);
            }
        }
        
        // ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        async function testModelLoading() {
            document.getElementById('modelTestBtn').disabled = true;
            updateProgress(0);
            
            try {
                log('=== ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
                updateProgress(10);
                
                const modelFiles = [
                    'models/text_det.onnx',
                    'models/text_rec_jp.onnx',
                    'models/text_angle.onnx',
                    'models/charset_jp.txt'
                ];
                
                for (let i = 0; i < modelFiles.length; i++) {
                    const modelFile = modelFiles[i];
                    updateProgress(20 + (i * 20));
                    
                    try {
                        const response = await fetch(modelFile, { method: 'HEAD' });
                        if (response.ok) {
                            const size = response.headers.get('content-length');
                            const sizeKB = Math.round(size / 1024);
                            
                            if (modelFile.endsWith('.onnx') && size < 1000000) {
                                log(`âš ï¸ ${modelFile}: ã‚µã‚¤ã‚ºãŒå°ã•ã™ãã¾ã™ (${sizeKB} KB) - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®å¯èƒ½æ€§`, 'warning');
                            } else {
                                log(`âœ… ${modelFile}: æ­£å¸¸ (${sizeKB} KB)`, 'success');
                            }
                        } else {
                            log(`âŒ ${modelFile}: è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (HTTP ${response.status})`, 'error');
                        }
                    } catch (error) {
                        log(`âŒ ${modelFile}: ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                    }
                }
                
                updateProgress(100);
                log('âœ… ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                document.getElementById('modelTestBtn').disabled = false;
                setTimeout(() => updateProgress(0), 2000);
            }
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        async function runPerformanceTest() {
            if (typeof ort === 'undefined') {
                log('âŒ ONNX Runtime WebãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            document.getElementById('perfTestBtn').disabled = true;
            
            try {
                log('=== ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
                
                const backends = ['wasm', 'webgl'];
                const results = [];
                
                for (const backend of backends) {
                    try {
                        log(`${backend}ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ†ã‚¹ãƒˆä¸­...`, 'info');
                        
                        const startTime = performance.now();
                        
                        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
                        const testModel = createTestModel();
                        const session = await ort.InferenceSession.create(testModel, {
                            executionProviders: [backend]
                        });
                        
                        const initTime = performance.now() - startTime;
                        
                        // æ¨è«–ãƒ†ã‚¹ãƒˆ
                        const inferenceStart = performance.now();
                        const inputTensor = new ort.Tensor('float32', [1, 2, 3, 4], [1, 4]);
                        const feeds = { x: inputTensor };
                        
                        // è¤‡æ•°å›å®Ÿè¡Œã—ã¦å¹³å‡ã‚’å–ã‚‹
                        const iterations = 10;
                        for (let i = 0; i < iterations; i++) {
                            await session.run(feeds);
                        }
                        
                        const inferenceTime = (performance.now() - inferenceStart) / iterations;
                        
                        await session.release();
                        
                        results.push({
                            backend,
                            initTime: Math.round(initTime),
                            inferenceTime: Math.round(inferenceTime * 100) / 100,
                            memoryUsage: performance.memory ? Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) : 'N/A'
                        });
                        
                        log(`âœ… ${backend}: åˆæœŸåŒ– ${Math.round(initTime)}ms, æ¨è«– ${Math.round(inferenceTime * 100) / 100}ms`, 'success');
                        
                    } catch (error) {
                        log(`âŒ ${backend}ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        results.push({
                            backend,
                            initTime: 'ã‚¨ãƒ©ãƒ¼',
                            inferenceTime: 'ã‚¨ãƒ©ãƒ¼',
                            memoryUsage: 'ã‚¨ãƒ©ãƒ¼'
                        });
                    }
                }
                
                // çµæœè¡¨ç¤º
                const performanceTable = document.getElementById('performanceTable');
                performanceTable.innerHTML = '';
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${result.backend}</td>
                        <td>${result.initTime}${typeof result.initTime === 'number' ? 'ms' : ''}</td>
                        <td>${result.inferenceTime}${typeof result.inferenceTime === 'number' ? 'ms' : ''}</td>
                        <td>${result.memoryUsage}${typeof result.memoryUsage === 'number' ? 'MB' : ''}</td>
                    `;
                    performanceTable.appendChild(row);
                });
                
                document.getElementById('performanceResults').style.display = 'block';
                log('âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                document.getElementById('perfTestBtn').disabled = false;
            }
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', function(event) {
            log(`JavaScript Error: ${event.message} at ${event.filename}:${event.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            log(`Unhandled Promise Rejection: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>