<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ - é ˜åæ›¸OCR</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
            border-left: 4px solid;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border-color: #28a745;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border-color: #dc3545;
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border-color: #17a2b8;
        }
        .warning { 
            background: #fff3cd; 
            color: #856404; 
            border-color: #ffc107;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 4px;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #495057;
        }
        
        #debugLog {
            background: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .log-error { color: #dc3545; }
        .log-success { color: #28a745; }
        .log-warning { color: #ffc107; }
        .log-info { color: #17a2b8; }
        
        .environment-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .environment-info h4 {
            margin-top: 0;
            color: #495057;
        }
        
        .environment-info table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .environment-info td {
            padding: 4px 8px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .environment-info td:first-child {
            font-weight: bold;
            width: 30%;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #007bff;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .fallback-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .notification-content {
            display: flex;
            align-items: flex-start;
            padding: 15px;
        }
        
        .notification-icon {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .notification-text {
            flex: 1;
        }
        
        .notification-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            margin: 0 0 0 10px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ GitHub Pages ç’°å¢ƒã§ã®é ˜åæ›¸OCRã‚¢ãƒ—ãƒªã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã§ã™ã€‚</p>
        
        <div class="environment-info">
            <h4>ğŸŒ ç’°å¢ƒæƒ…å ±</h4>
            <table>
                <tr><td>ãƒ›ã‚¹ãƒˆå:</td><td id="hostname">-</td></tr>
                <tr><td>ãƒ—ãƒ­ãƒˆã‚³ãƒ«:</td><td id="protocol">-</td></tr>
                <tr><td>ãƒ‘ã‚¹:</td><td id="pathname">-</td></tr>
                <tr><td>GitHub Pages:</td><td id="isGitHubPages">-</td></tr>
                <tr><td>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰:</td><td id="fallbackMode">-</td></tr>
                <tr><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ:</td><td id="userAgent">-</td></tr>
            </table>
        </div>
        
        <div id="overallStatus" class="status info">
            ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ è‡ªå‹•è¨ºæ–­ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="runFullDiagnostics()" id="diagnosticsBtn">å®Œå…¨è¨ºæ–­ã‚’å®Ÿè¡Œ</button>
            <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <div class="progress-bar" style="display: none;" id="diagnosticsProgress">
                <div class="progress-fill" id="diagnosticsProgressFill"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª å€‹åˆ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testLibraryLoading()">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testModelFiles()">ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testOCRInitialization()">OCRåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testFieldExtractor()">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡ºãƒ†ã‚¹ãƒˆ</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“± å®Ÿæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testBasicOCR()">åŸºæœ¬OCRæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="openMainApp()">ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚’é–‹ã</button>
            <button onclick="openTestBasic()">åŸºæœ¬ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’é–‹ã</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
            <div id="debugLog"></div>
        </div>
    </div>

    <!-- å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="libs/tesseract.min.js"></script>
    <script src="js/field-extractor.js"></script>
    <script src="js/github-pages-fix.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let diagnosticsRunning = false;
        let testResults = {};
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateEnvironmentInfo();
            log('GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
        });
        
        // ç’°å¢ƒæƒ…å ±ã®æ›´æ–°
        function updateEnvironmentInfo() {
            document.getElementById('hostname').textContent = window.location.hostname;
            document.getElementById('protocol').textContent = window.location.protocol;
            document.getElementById('pathname').textContent = window.location.pathname;
            
            const isGitHubPages = window.location.hostname.includes('github.io') || 
                                 window.location.hostname.includes('github.com');
            document.getElementById('isGitHubPages').textContent = isGitHubPages ? 'âœ… ã¯ã„' : 'âŒ ã„ã„ãˆ';
            
            const fallbackMode = window.FORCE_TESSERACT_FALLBACK || window.GITHUB_PAGES_MODE;
            document.getElementById('fallbackMode').textContent = fallbackMode ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹';
            
            document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 80) + '...';
        }
        
        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, message);
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateOverallStatus(message, type = 'info') {
            const status = document.getElementById('overallStatus');
            status.textContent = message;
            status.className = `status ${type}`;
            log(message, type);
        }
        
        // é€²è¡ŒçŠ¶æ³ã®æ›´æ–°
        function updateProgress(percentage) {
            const progressBar = document.getElementById('diagnosticsProgress');
            const progressFill = document.getElementById('diagnosticsProgressFill');
            
            if (percentage > 0) {
                progressBar.style.display = 'block';
                progressFill.style.width = percentage + '%';
            } else {
                progressBar.style.display = 'none';
            }
        }
        
        // å®Œå…¨è¨ºæ–­ã®å®Ÿè¡Œ
        async function runFullDiagnostics() {
            if (diagnosticsRunning) return;
            
            diagnosticsRunning = true;
            document.getElementById('diagnosticsBtn').disabled = true;
            testResults = {};
            
            try {
                updateOverallStatus('å®Œå…¨è¨ºæ–­ã‚’å®Ÿè¡Œä¸­...', 'info');
                updateProgress(0);
                
                // 1. åŸºæœ¬ç’°å¢ƒãƒã‚§ãƒƒã‚¯
                log('=== 1. åŸºæœ¬ç’°å¢ƒãƒã‚§ãƒƒã‚¯ ===', 'info');
                updateProgress(10);
                await testBasicEnvironment();
                
                // 2. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
                log('=== 2. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ ===', 'info');
                updateProgress(25);
                await testLibraryLoading();
                
                // 3. ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ
                log('=== 3. ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ ===', 'info');
                updateProgress(40);
                await testModelFiles();
                
                // 4. OCRåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                log('=== 4. OCRåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ ===', 'info');
                updateProgress(60);
                await testOCRInitialization();
                
                // 5. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡ºãƒ†ã‚¹ãƒˆ
                log('=== 5. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡ºãƒ†ã‚¹ãƒˆ ===', 'info');
                updateProgress(80);
                await testFieldExtractor();
                
                // 6. çµæœã®é›†è¨ˆ
                updateProgress(100);
                await generateDiagnosticsReport();
                
                updateOverallStatus('å®Œå…¨è¨ºæ–­ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                
            } catch (error) {
                log(`å®Œå…¨è¨ºæ–­ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                updateOverallStatus('å®Œå…¨è¨ºæ–­ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
            } finally {
                diagnosticsRunning = false;
                document.getElementById('diagnosticsBtn').disabled = false;
                updateProgress(0);
            }
        }
        
        // åŸºæœ¬ç’°å¢ƒãƒã‚§ãƒƒã‚¯
        async function testBasicEnvironment() {
            const tests = [
                { name: 'fetch API', test: () => typeof fetch !== 'undefined' },
                { name: 'Web Worker', test: () => typeof Worker !== 'undefined' },
                { name: 'IndexedDB', test: () => typeof indexedDB !== 'undefined' },
                { name: 'Canvas API', test: () => typeof HTMLCanvasElement !== 'undefined' },
                { name: 'File API', test: () => typeof File !== 'undefined' },
                { name: 'Blob API', test: () => typeof Blob !== 'undefined' }
            ];
            
            let passed = 0;
            for (const test of tests) {
                try {
                    const result = test.test();
                    if (result) {
                        log(`âœ… ${test.name}: åˆ©ç”¨å¯èƒ½`, 'success');
                        passed++;
                    } else {
                        log(`âŒ ${test.name}: åˆ©ç”¨ä¸å¯`, 'error');
                    }
                } catch (error) {
                    log(`âŒ ${test.name}: ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                }
            }
            
            testResults.basicEnvironment = { passed, total: tests.length };
        }
        
        // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        async function testLibraryLoading() {
            const libraries = [
                { name: 'Tesseract.js', path: 'libs/tesseract.min.js', global: 'Tesseract' },
                { name: 'ONNX Runtime', path: 'libs/ort.min.js', global: 'ort' },
                { name: 'OpenCV.js', path: 'libs/opencv.js', global: 'cv' },
                { name: 'JSZip', path: 'libs/jszip.min.js', global: 'JSZip' }
            ];
            
            let passed = 0;
            for (const lib of libraries) {
                try {
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
                    const response = await fetch(lib.path, { method: 'HEAD' });
                    if (response.ok) {
                        const size = response.headers.get('content-length');
                        log(`âœ… ${lib.name}: ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ (${size} bytes)`, 'success');
                        
                        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®ç¢ºèª
                        if (typeof window[lib.global] !== 'undefined') {
                            log(`âœ… ${lib.name}: ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°åˆ©ç”¨å¯èƒ½`, 'success');
                            passed++;
                        } else {
                            log(`âš ï¸ ${lib.name}: ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°æœªå®šç¾©`, 'warning');
                        }
                    } else {
                        log(`âŒ ${lib.name}: HTTP ${response.status}`, 'error');
                    }
                } catch (error) {
                    log(`âŒ ${lib.name}: ${error.message}`, 'error');
                }
            }
            
            testResults.libraryLoading = { passed, total: libraries.length };
        }
        
        // ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ
        async function testModelFiles() {
            const models = [
                { name: 'ãƒ†ã‚­ã‚¹ãƒˆæ¤œå‡ºãƒ¢ãƒ‡ãƒ«', path: 'models/text_det.onnx', minSize: 1000000 },
                { name: 'ãƒ†ã‚­ã‚¹ãƒˆèªè­˜ãƒ¢ãƒ‡ãƒ«', path: 'models/text_rec_jp.onnx', minSize: 1000000 },
                { name: 'è§’åº¦åˆ†é¡ãƒ¢ãƒ‡ãƒ«', path: 'models/text_angle.onnx', minSize: 100000 },
                { name: 'æ–‡å­—ã‚»ãƒƒãƒˆ', path: 'models/charset_jp.txt', minSize: 1000 }
            ];
            
            let passed = 0;
            for (const model of models) {
                try {
                    const response = await fetch(model.path, { method: 'HEAD' });
                    if (response.ok) {
                        const size = parseInt(response.headers.get('content-length') || '0');
                        if (size >= model.minSize) {
                            log(`âœ… ${model.name}: æ­£å¸¸ (${size} bytes)`, 'success');
                            passed++;
                        } else {
                            log(`âš ï¸ ${model.name}: ã‚µã‚¤ã‚ºä¸è¶³ (${size} bytes, æœ€å°: ${model.minSize})`, 'warning');
                        }
                    } else {
                        log(`âŒ ${model.name}: HTTP ${response.status}`, 'error');
                    }
                } catch (error) {
                    log(`âŒ ${model.name}: ${error.message}`, 'error');
                }
            }
            
            testResults.modelFiles = { passed, total: models.length };
        }
        
        // OCRåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        async function testOCRInitialization() {
            try {
                if (typeof Tesseract === 'undefined') {
                    log('âŒ Tesseract.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    testResults.ocrInitialization = { passed: 0, total: 1 };
                    return;
                }
                
                log('Tesseract.jsåˆæœŸåŒ–ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
                
                const worker = await Tesseract.createWorker({
                    logger: m => {
                        if (m.status === 'loading tesseract core') {
                            log(`Tesseract.js: ${m.status}`, 'info');
                        }
                    }
                });
                
                await worker.loadLanguage('eng');
                await worker.initialize('eng');
                
                log('âœ… Tesseract.jsåˆæœŸåŒ–æˆåŠŸ', 'success');
                
                await worker.terminate();
                log('âœ… Tesseract.jsãƒ¯ãƒ¼ã‚«ãƒ¼çµ‚äº†æˆåŠŸ', 'success');
                
                testResults.ocrInitialization = { passed: 1, total: 1 };
                
            } catch (error) {
                log(`âŒ OCRåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                testResults.ocrInitialization = { passed: 0, total: 1 };
            }
        }
        
        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡ºãƒ†ã‚¹ãƒˆ
        async function testFieldExtractor() {
            try {
                if (typeof FieldExtractor === 'undefined') {
                    log('âŒ FieldExtractorãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    testResults.fieldExtractor = { passed: 0, total: 1 };
                    return;
                }
                
                const extractor = new FieldExtractor();
                
                // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
                const testTextBlocks = [
                    { text: '2024/03/15', confidence: 0.9, boundingBox: { x: 10, y: 10, width: 100, height: 20 } },
                    { text: 'ã‚³ãƒ³ãƒ“ãƒ‹ã‚¨ãƒ³ã‚¹ã‚¹ãƒˆã‚¢', confidence: 0.8, boundingBox: { x: 10, y: 40, width: 200, height: 25 } },
                    { text: 'åˆè¨ˆ 1,500å††', confidence: 0.85, boundingBox: { x: 10, y: 100, width: 120, height: 20 } }
                ];
                
                const result = await extractor.extractFields(testTextBlocks);
                
                if (result && typeof result === 'object') {
                    log('âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡ºãƒ†ã‚¹ãƒˆæˆåŠŸ', 'success');
                    log(`æŠ½å‡ºçµæœ: æ—¥ä»˜=${result.date?.value}, é‡‘é¡=${result.amount?.value}`, 'info');
                    testResults.fieldExtractor = { passed: 1, total: 1 };
                } else {
                    log('âŒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡ºçµæœãŒä¸æ­£ã§ã™', 'error');
                    testResults.fieldExtractor = { passed: 0, total: 1 };
                }
                
            } catch (error) {
                log(`âŒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŠ½å‡ºã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                testResults.fieldExtractor = { passed: 0, total: 1 };
            }
        }
        
        // è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
        async function generateDiagnosticsReport() {
            log('=== è¨ºæ–­çµæœã‚µãƒãƒªãƒ¼ ===', 'info');
            
            let totalPassed = 0;
            let totalTests = 0;
            
            for (const [category, result] of Object.entries(testResults)) {
                const percentage = Math.round((result.passed / result.total) * 100);
                log(`${category}: ${result.passed}/${result.total} (${percentage}%)`, 
                    percentage >= 80 ? 'success' : percentage >= 50 ? 'warning' : 'error');
                
                totalPassed += result.passed;
                totalTests += result.total;
            }
            
            const overallPercentage = Math.round((totalPassed / totalTests) * 100);
            log(`ç·åˆ: ${totalPassed}/${totalTests} (${overallPercentage}%)`, 
                overallPercentage >= 80 ? 'success' : overallPercentage >= 50 ? 'warning' : 'error');
            
            // æ¨å¥¨äº‹é …
            log('=== æ¨å¥¨äº‹é … ===', 'info');
            if (testResults.modelFiles?.passed < testResults.modelFiles?.total) {
                log('âš ï¸ ONNXãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚Tesseract.jsãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™ã€‚', 'warning');
            }
            if (testResults.ocrInitialization?.passed > 0) {
                log('âœ… åŸºæœ¬çš„ãªOCRæ©Ÿèƒ½ã¯åˆ©ç”¨å¯èƒ½ã§ã™ã€‚', 'success');
            }
            if (overallPercentage >= 60) {
                log('âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯åŸºæœ¬çš„ãªæ©Ÿèƒ½ã§å‹•ä½œå¯èƒ½ã§ã™ã€‚', 'success');
            }
        }
        
        // åŸºæœ¬OCRæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        async function testBasicOCR() {
            try {
                log('åŸºæœ¬OCRæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®ç°¡å˜ãªç”»åƒã‚’ä½œæˆ
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 100;
                const ctx = canvas.getContext('2d');
                
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, 200, 100);
                ctx.fillStyle = 'black';
                ctx.font = '20px Arial';
                ctx.fillText('TEST 123', 50, 50);
                
                if (typeof Tesseract !== 'undefined') {
                    const worker = await Tesseract.createWorker();
                    await worker.loadLanguage('eng');
                    await worker.initialize('eng');
                    
                    const result = await worker.recognize(canvas);
                    log(`OCRçµæœ: "${result.data.text.trim()}"`, 'info');
                    
                    await worker.terminate();
                    log('âœ… åŸºæœ¬OCRæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸ', 'success');
                } else {
                    log('âŒ Tesseract.jsãŒåˆ©ç”¨ã§ãã¾ã›ã‚“', 'error');
                }
                
            } catch (error) {
                log(`âŒ åŸºæœ¬OCRæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // å¤–éƒ¨ãƒšãƒ¼ã‚¸ã‚’é–‹ã
        function openMainApp() {
            window.open('index.html', '_blank');
        }
        
        function openTestBasic() {
            window.open('test-basic.html', '_blank');
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', function(event) {
            log(`JavaScript Error: ${event.message} at ${event.filename}:${event.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            log(`Unhandled Promise Rejection: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>