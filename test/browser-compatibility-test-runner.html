<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄß„ÉÜ„Çπ„Éà - È†òÂèéÊõ∏OCR„Ç¢„Éó„É™</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .browser-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .browser-info h3 {
            margin-top: 0;
            color: #333;
        }

        .browser-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-right: 10px;
        }

        .browser-badge.safari { background: #007AFF; color: white; }
        .browser-badge.chrome { background: #4285F4; color: white; }
        .browser-badge.unknown { background: #666; color: white; }

        .os-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            background: #28a745;
            color: white;
            font-weight: bold;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #0056CC;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #545b62;
        }

        .progress {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }

        .results {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            color: white;
            font-weight: bold;
        }

        .summary-card.total { background: #6c757d; }
        .summary-card.passed { background: #28a745; }
        .summary-card.failed { background: #dc3545; }
        .summary-card.errors { background: #fd7e14; }

        .summary-card .number {
            font-size: 2em;
            display: block;
            margin-bottom: 5px;
        }

        .compatibility-status {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .compatibility-status.compatible {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .compatibility-status.incompatible {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .category-results {
            margin-bottom: 30px;
        }

        .category-header {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            border-bottom: 2px solid #dee2e6;
            font-weight: bold;
            color: #495057;
        }

        .test-list {
            background: white;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
        }

        .test-item {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-name {
            font-weight: 500;
            color: #333;
        }

        .test-status {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .test-status.pass {
            background: #d4edda;
            color: #155724;
        }

        .test-status.fail {
            background: #f8d7da;
            color: #721c24;
        }

        .test-status.error {
            background: #fff3cd;
            color: #856404;
        }

        .test-message {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .recommendations h4 {
            margin-top: 0;
            color: #856404;
        }

        .recommendations ul {
            margin-bottom: 0;
        }

        .recommendations li {
            margin-bottom: 10px;
            color: #856404;
        }

        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .console-output pre {
            margin: 0;
            white-space: pre-wrap;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .summary {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                margin: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ „Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄß„ÉÜ„Çπ„Éà</h1>
        <p>iOS Safari 16+ / Android Chrome 10+ ÂØæÂøúÁ¢∫Ë™ç</p>
    </div>

    <div class="browser-info">
        <h3>üîç Ê§úÂá∫„Åï„Çå„Åü„Éñ„É©„Ç¶„Ç∂ÊÉÖÂ†±</h3>
        <div id="browser-details">
            <span id="browser-badge" class="browser-badge unknown">Ê§úÂá∫‰∏≠...</span>
            <span id="os-badge" class="os-badge">Ê§úÂá∫‰∏≠...</span>
        </div>
        <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
            User Agent: <span id="user-agent"></span>
        </div>
    </div>

    <div class="controls">
        <button id="run-tests" class="btn">üöÄ ‰∫íÊèõÊÄß„ÉÜ„Çπ„Éà„ÇíÂÆüË°å</button>
        <button id="clear-results" class="btn secondary" disabled>üóëÔ∏è ÁµêÊûú„Çí„ÇØ„É™„Ç¢</button>
    </div>

    <div id="progress" class="progress">
        <h3>‚è≥ „ÉÜ„Çπ„ÉàÂÆüË°å‰∏≠...</h3>
        <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
        </div>
        <div id="progress-text">Ê∫ñÂÇô‰∏≠...</div>
    </div>

    <div id="results" class="results">
        <div id="compatibility-status" class="compatibility-status">
            <!-- ‰∫íÊèõÊÄß„Çπ„ÉÜ„Éº„Çø„Çπ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
        </div>

        <div class="summary">
            <div class="summary-card total">
                <span id="total-tests" class="number">0</span>
                <span>Á∑è„ÉÜ„Çπ„ÉàÊï∞</span>
            </div>
            <div class="summary-card passed">
                <span id="passed-tests" class="number">0</span>
                <span>ÊàêÂäü</span>
            </div>
            <div class="summary-card failed">
                <span id="failed-tests" class="number">0</span>
                <span>Â§±Êïó</span>
            </div>
            <div class="summary-card errors">
                <span id="error-tests" class="number">0</span>
                <span>„Ç®„É©„Éº</span>
            </div>
        </div>

        <div id="category-results">
            <!-- „Ç´„ÉÜ„Ç¥„É™Âà•ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
        </div>

        <div id="recommendations" class="recommendations" style="display: none;">
            <h4>üí° Êé®Â•®‰∫ãÈ†Ö</h4>
            <ul id="recommendations-list">
                <!-- Êé®Â•®‰∫ãÈ†Ö„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
            </ul>
        </div>
    </div>

    <div id="console-output" class="console-output" style="display: none;">
        <h4 style="color: #d4d4d4; margin-top: 0;">üìã „Ç≥„É≥„ÇΩ„Éº„É´Âá∫Âäõ</h4>
        <pre id="console-content"></pre>
    </div>

    <script src="browser-compatibility-tests.js"></script>
    <script>
        let compatibilityTests;
        let consoleOutput = [];

        // „Ç≥„É≥„ÇΩ„Éº„É´Âá∫Âäõ„Çí„Ç≠„É£„Éó„ÉÅ„É£
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;

        console.log = function(...args) {
            consoleOutput.push(`[LOG] ${args.join(' ')}`);
            updateConsoleOutput();
            originalConsoleLog.apply(console, args);
        };

        console.error = function(...args) {
            consoleOutput.push(`[ERROR] ${args.join(' ')}`);
            updateConsoleOutput();
            originalConsoleError.apply(console, args);
        };

        console.warn = function(...args) {
            consoleOutput.push(`[WARN] ${args.join(' ')}`);
            updateConsoleOutput();
            originalConsoleWarn.apply(console, args);
        };

        function updateConsoleOutput() {
            const consoleElement = document.getElementById('console-content');
            const consoleContainer = document.getElementById('console-output');
            
            if (consoleOutput.length > 0) {
                consoleElement.textContent = consoleOutput.join('\n');
                consoleContainer.style.display = 'block';
                consoleElement.scrollTop = consoleElement.scrollHeight;
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            compatibilityTests = new BrowserCompatibilityTests();
            updateBrowserInfo();

            // URL„Éë„É©„É°„Éº„Çø„ÅßËá™ÂãïÂÆüË°å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('run-compatibility-tests')) {
                setTimeout(runTests, 1000);
            }
        });

        function updateBrowserInfo() {
            const browserInfo = compatibilityTests.browserInfo;
            const userAgent = compatibilityTests.userAgent;

            // „Éñ„É©„Ç¶„Ç∂„Éê„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞
            const browserBadge = document.getElementById('browser-badge');
            browserBadge.textContent = `${browserInfo.browser} ${browserInfo.version}`;
            browserBadge.className = `browser-badge ${browserInfo.browser.toLowerCase()}`;

            // OS„Éê„ÉÉ„Ç∏„ÅÆÊõ¥Êñ∞
            const osBadge = document.getElementById('os-badge');
            osBadge.textContent = browserInfo.os;

            // User Agent„ÅÆË°®Á§∫
            document.getElementById('user-agent').textContent = userAgent;
        }

        async function runTests() {
            const runButton = document.getElementById('run-tests');
            const clearButton = document.getElementById('clear-results');
            const progressDiv = document.getElementById('progress');
            const resultsDiv = document.getElementById('results');

            // UI„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            runButton.disabled = true;
            runButton.textContent = '‚è≥ „ÉÜ„Çπ„ÉàÂÆüË°å‰∏≠...';
            clearButton.disabled = true;
            progressDiv.style.display = 'block';
            resultsDiv.style.display = 'none';
            consoleOutput = [];

            try {
                // „Éó„É≠„Ç∞„É¨„ÇπÊõ¥Êñ∞„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
                const progressSteps = [
                    { text: 'Web API‰∫íÊèõÊÄß„Çí„ÉÜ„Çπ„Éà‰∏≠...', progress: 20 },
                    { text: 'PWAÊ©üËÉΩ„Çí„ÉÜ„Çπ„Éà‰∏≠...', progress: 40 },
                    { text: 'OCRÊ©üËÉΩ„Çí„ÉÜ„Çπ„Éà‰∏≠...', progress: 60 },
                    { text: '„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ©üËÉΩ„Çí„ÉÜ„Çπ„Éà‰∏≠...', progress: 80 },
                    { text: '„Éñ„É©„Ç¶„Ç∂Âõ∫Êúâ„ÅÆÂïèÈ°å„Çí„ÉÜ„Çπ„Éà‰∏≠...', progress: 100 }
                ];

                for (const step of progressSteps) {
                    updateProgress(step.text, step.progress);
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                // ÂÆüÈöõ„ÅÆ„ÉÜ„Çπ„ÉàÂÆüË°å
                const report = await compatibilityTests.runAllTests();
                
                // ÁµêÊûú„ÅÆË°®Á§∫
                displayResults(report);

            } catch (error) {
                console.error('„ÉÜ„Çπ„ÉàÂÆüË°å‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', error);
                alert(`„ÉÜ„Çπ„ÉàÂÆüË°å‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`);
            } finally {
                // UI„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
                runButton.disabled = false;
                runButton.textContent = 'üöÄ ‰∫íÊèõÊÄß„ÉÜ„Çπ„Éà„ÇíÂÆüË°å';
                clearButton.disabled = false;
                progressDiv.style.display = 'none';
            }
        }

        function updateProgress(text, progress) {
            document.getElementById('progress-text').textContent = text;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        function displayResults(report) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';

            // „Çµ„Éû„É™„Éº„ÅÆÊõ¥Êñ∞
            document.getElementById('total-tests').textContent = report.summary.total;
            document.getElementById('passed-tests').textContent = report.summary.passed;
            document.getElementById('failed-tests').textContent = report.summary.failed;
            document.getElementById('error-tests').textContent = report.summary.errors;

            // ‰∫íÊèõÊÄß„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆÊõ¥Êñ∞
            const statusDiv = document.getElementById('compatibility-status');
            if (report.compatible) {
                statusDiv.className = 'compatibility-status compatible';
                statusDiv.innerHTML = '‚úÖ „Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ‰∫íÊèõÊÄß„Åå„ÅÇ„Çä„Åæ„Åô';
            } else {
                statusDiv.className = 'compatibility-status incompatible';
                statusDiv.innerHTML = '‚ö†Ô∏è „Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„Å´„ÅØ‰∫íÊèõÊÄß„ÅÆÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åô';
            }

            // „Ç´„ÉÜ„Ç¥„É™Âà•ÁµêÊûú„ÅÆË°®Á§∫
            displayCategoryResults(report);

            // Êé®Â•®‰∫ãÈ†Ö„ÅÆË°®Á§∫
            if (report.recommendations && report.recommendations.length > 0) {
                displayRecommendations(report.recommendations);
            }

            console.log('üìä „ÉÜ„Çπ„ÉàÁµêÊûú„Çµ„Éû„É™„Éº');
            console.log(`ÂêàÊ†º: ${report.summary.passed}/${report.summary.total}`);
            console.log(`ÊàêÂäüÁéá: ${(report.summary.passed / report.summary.total * 100).toFixed(1)}%`);
            
            if (report.compatible) {
                console.log('üéâ „Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄß„ÉÜ„Çπ„Éà„Å´ÂêàÊ†º„Åó„Åæ„Åó„ÅüÔºÅ');
            } else {
                console.log('‚ö†Ô∏è „Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄß„Å´ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÊé®Â•®‰∫ãÈ†Ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }

        function displayCategoryResults(report) {
            const categoryResultsDiv = document.getElementById('category-results');
            categoryResultsDiv.innerHTML = '';

            Object.keys(report.categories).forEach(category => {
                const categoryData = report.categories[category];
                const categoryResults = report.results.filter(r => r.category === category);

                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-results';

                const headerDiv = document.createElement('div');
                headerDiv.className = 'category-header';
                headerDiv.innerHTML = `
                    ${category} 
                    <span style="float: right;">
                        ${categoryData.passed}/${categoryData.total} ÊàêÂäü
                    </span>
                `;

                const testListDiv = document.createElement('div');
                testListDiv.className = 'test-list';

                categoryResults.forEach(result => {
                    const testItemDiv = document.createElement('div');
                    testItemDiv.className = 'test-item';

                    const statusClass = result.status.toLowerCase() === 'pass' ? 'pass' : 
                                       result.status.toLowerCase() === 'fail' ? 'fail' : 'error';

                    testItemDiv.innerHTML = `
                        <div>
                            <div class="test-name">${result.test}</div>
                            <div class="test-message">${result.message}</div>
                        </div>
                        <div class="test-status ${statusClass}">${result.status}</div>
                    `;

                    testListDiv.appendChild(testItemDiv);
                });

                categoryDiv.appendChild(headerDiv);
                categoryDiv.appendChild(testListDiv);
                categoryResultsDiv.appendChild(categoryDiv);
            });
        }

        function displayRecommendations(recommendations) {
            const recommendationsDiv = document.getElementById('recommendations');
            const recommendationsList = document.getElementById('recommendations-list');
            
            recommendationsList.innerHTML = '';
            recommendations.forEach(recommendation => {
                const li = document.createElement('li');
                li.textContent = recommendation;
                recommendationsList.appendChild(li);
            });

            recommendationsDiv.style.display = 'block';
        }

        function clearResults() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('console-output').style.display = 'none';
            consoleOutput = [];
            
            // „Çµ„Éû„É™„Éº„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('total-tests').textContent = '0';
            document.getElementById('passed-tests').textContent = '0';
            document.getElementById('failed-tests').textContent = '0';
            document.getElementById('error-tests').textContent = '0';
            
            document.getElementById('clear-results').disabled = true;
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
        document.getElementById('run-tests').addEventListener('click', runTests);
        document.getElementById('clear-results').addEventListener('click', clearResults);
    </script>
</body>
</html>