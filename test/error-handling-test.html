<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="../styles/main.css">
    <style>
        body {
            padding: 2rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        .test-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            margin: 0.25rem;
        }
        .test-button:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body>
    <h1>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>æ¨©é™ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testCameraError()">ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testPermissionError()">æ¨©é™æ‹’å¦ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ</button>
    </div>
    
    <div class="test-section">
        <h2>ãƒªã‚½ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testMemoryError()">ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testStorageError()">ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸è¶³ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testTimeoutError()">ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ</button>
    </div>
    
    <div class="test-section">
        <h2>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="testFileError()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="testNetworkError()">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆ</button>
    </div>
    
    <div class="test-section">
        <h2>åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ</h2>
        <button class="test-button" onclick="runAllErrorTests()">å…¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
        <button class="test-button" onclick="runSpecificTest('classification')">ã‚¨ãƒ©ãƒ¼åˆ†é¡ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="runSpecificTest('permission')">æ¨©é™ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="runSpecificTest('resource')">ãƒªã‚½ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="runSpecificTest('fallback')">ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="runSpecificTest('usability')">ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</button>
    </div>
    
    <div class="test-section">
        <h2>ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h2>
        <button class="test-button" onclick="showResourceInfo()">ãƒªã‚½ãƒ¼ã‚¹æƒ…å ±ã‚’è¡¨ç¤º</button>
        <button class="test-button" onclick="showRecoveryStats()">å¾©æ—§çµ±è¨ˆã‚’è¡¨ç¤º</button>
        <button class="test-button" onclick="clearErrorLogs()">ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢</button>
    </div>
    
    <div id="info-display" style="margin-top: 2rem; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; display: none;">
        <h3>ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h3>
        <pre id="info-content"></pre>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="../js/error-recovery.js"></script>
    <script src="../js/error-handler.js"></script>
    <script src="../js/error-display.js"></script>
    <script src="../js/resource-monitor.js"></script>
    <script src="error-handling-tests.js"></script>
    
    <script>
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–
        const errorHandler = new ErrorHandler();
        const errorDisplay = new ErrorDisplay();
        const resourceMonitor = new ResourceMonitor();
        
        // ãƒ†ã‚¹ãƒˆé–¢æ•°
        async function testCameraError() {
            const error = new Error('ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ');
            error.name = 'NotAllowedError';
            
            const errorResult = await errorHandler.handleError(error, { 
                operation: 'camera',
                permissionState: 'denied'
            });
            
            errorDisplay.show(errorResult, () => {
                console.log('ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼ã®å†è©¦è¡Œ');
            });
        }
        
        async function testPermissionError() {
            const error = new Error('æ¨©é™ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ');
            error.name = 'NotAllowedError';
            
            const errorResult = await errorHandler.handleError(error, { 
                operation: 'permission',
                type: 'storage'
            });
            
            errorDisplay.show(errorResult);
        }
        
        async function testMemoryError() {
            const error = new Error('ãƒ¡ãƒ¢ãƒªãŒä¸è¶³ã—ã¦ã„ã¾ã™');
            error.name = 'RangeError';
            
            const errorResult = await errorHandler.handleError(error, { 
                operation: 'ocr',
                memoryUsage: { used: 900000000, limit: 1000000000 }
            });
            
            errorDisplay.show(errorResult, () => {
                console.log('ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼ã®å†è©¦è¡Œ');
            });
        }
        
        async function testStorageError() {
            const error = new Error('ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
            error.name = 'QuotaExceededError';
            
            const errorResult = await errorHandler.handleError(error, { 
                operation: 'storage',
                requiredSize: 50000000
            });
            
            errorDisplay.show(errorResult);
        }
        
        async function testTimeoutError() {
            const error = new Error('å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
            error.name = 'TimeoutError';
            
            const errorResult = await errorHandler.handleError(error, { 
                operation: 'ocr',
                timeout: true,
                duration: 30000
            });
            
            errorDisplay.show(errorResult, () => {
                console.log('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼ã®å†è©¦è¡Œ');
            });
        }
        
        async function testFileError() {
            const error = new Error('ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
            error.name = 'TypeError';
            
            const errorResult = await errorHandler.handleError(error, { 
                operation: 'file',
                fileType: 'image/bmp',
                fileSize: 5000000
            });
            
            errorDisplay.show(errorResult);
        }
        
        async function testNetworkError() {
            const error = new Error('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ');
            error.name = 'NetworkError';
            
            const errorResult = await errorHandler.handleError(error, { 
                operation: 'network',
                url: 'https://example.com/api'
            });
            
            errorDisplay.show(errorResult);
        }
        
        function showResourceInfo() {
            const info = resourceMonitor.getResourceInfo();
            document.getElementById('info-content').textContent = JSON.stringify(info, null, 2);
            document.getElementById('info-display').style.display = 'block';
        }
        
        function showRecoveryStats() {
            const stats = errorHandler.errorRecovery.generateRecoveryReport();
            document.getElementById('info-content').textContent = stats;
            document.getElementById('info-display').style.display = 'block';
        }
        
        function clearErrorLogs() {
            errorHandler.clearErrorLogs();
            errorHandler.errorRecovery.clearRecoveryHistory();
            alert('ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã¨å¾©æ—§å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
        window.addEventListener('error', async (event) => {
            const errorResult = await errorHandler.handleError(event.error, { 
                type: 'javascript_error',
                filename: event.filename,
                lineno: event.lineno
            });
            errorDisplay.show(errorResult);
        });
        
        // åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆé–¢æ•°
        async function runAllErrorTests() {
            console.log('ğŸ§ª åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...');
            const tests = new ErrorHandlingTests();
            const results = await tests.runAllTests();
            
            alert(`ãƒ†ã‚¹ãƒˆå®Œäº†!\næˆåŠŸ: ${results.passedTests}/${results.totalTests} (${results.successRate}%)`);
        }
        
        async function runSpecificTest(testType) {
            console.log(`ğŸ¯ ${testType} ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...`);
            const tests = new ErrorHandlingTests();
            await tests.runSpecificTest(testType);
        }
        
        console.log('ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        console.log('å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç•°ãªã‚‹ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™');
        console.log('åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€Œå…¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
    </script>
</body>
</html>